/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   print_map.c                                        :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: lsandor- <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/02/07 17:55:20 by lsandor-          #+#    #+#             */
/*   Updated: 2019/02/09 11:21:21 by lsandor-         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fdf.h"

void ft_put_line(t_fdf *fdf)
{
	t_alg alg;
	alg.dx = fdf->second.x - fdf->first.x;
	alg.dy = fdf->second.y - fdf->first.y;
	alg.x = fdf->first.x;
	alg.y = fdf->first.y;
	alg.p = 2 * alg.dy - alg.dx;
	while(alg.x < fdf->second.x)
	{
		if(alg.p >= 0)
		{
			printf("x: %d, y: %d\n",alg.x, alg.y);
			ft_set_pixel_to_image(fdf, alg.x, alg.y, 16777215);
			alg.y++;
			alg.p = alg.p + 2 * alg.dy - 2 * alg.dx;
		}
		else
		{
			printf("x: %d, y: %d\n",alg.x, alg.y);
			ft_set_pixel_to_image(fdf, alg.x, alg.y, 16777215);
			alg.p = alg.p + 2 * alg.dy;
		}
		alg.x++;
	}
}

static void	ft_set_color(t_fdf *fdf)
{
	double third;

	third = fdf->options->z0 / 3;
	if (fdf->first.z < 0)
		fdf->first.color = 0x4C2908;
	else if (fdf->first.z <= third)
		fdf->first.color = 0xDB4A4A;
	else if (fdf->first.z <= third * 2)
		fdf->first.color = 0xD67022;
	else if (fdf->first.z <= fdf->options->z0)
		fdf->first.color = 0xE5D120;
	if (fdf->second.z < 0)
		fdf->second.color = 0x4C2908;
	else if (fdf->second.z <= third)
		fdf->second.color = 0xDB4A4A;
	else if (fdf->second.z <= third * 2)
		fdf->second.color = 0xD67022;
	else if (fdf->second.z <= fdf->options->z0)
		fdf->second.color = 0xE5D120;
}

void	ft_print_map(t_fdf fdf)
{
	ft_calculate_angles(&fdf);
	while (fdf.lines)
	{
		fdf.first = *((t_line *)fdf.lines->content)->a;
		fdf.second = *((t_line *)fdf.lines->content)->b;
		ft_set_color(&fdf);
		ft_rotate_dots(&fdf.first, fdf.res,  &fdf);
		ft_rotate_dots(&fdf.second, fdf.res, &fdf);
		ft_put_line(&fdf);
		fdf.lines = fdf.lines->next;
	}
	mlx_put_image_to_window(fdf.mlx_ptr, fdf.win_ptr, fdf.image->img_ptr, 0, 0);
}
